<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Judul Halaman Dinamis -->
    <title>Situs Film - Template Master</title>
    
    <!-- Deskripsi Meta SEO -->
    <meta name="description" content="Temukan sinopsis, trailer, pemeran, dan detail film-film terbaru.">

    <!-- Tag Meta Open Graph (untuk Facebook) -->
    <meta property="og:site_name" content="Streamflix">
    <meta property="og:title" content="Judul Film Placeholder">
    <meta property="og:description" content="Deskripsi film placeholder">
    <meta property="og:url" content="https://streamflix-now.pages.dev/">
    <meta property="og:image" content="https://placehold.co/1200x630/000000/FFFFFF?text=Poster%20Film">
    <meta property="og:type" content="video.movie">
    <meta property="fb:app_id" content="100073133663144">

    <!-- Tag Meta Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@WatchStream123">
    <meta name="twitter:title" content="Judul Film Placeholder">
    <meta name="twitter:description" content="Deskripsi film placeholder">
    <meta name="twitter:image" content="https://placehold.co/1200x630/000000/FFFFFF?text=Poster%20Film">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1d232a',
                        secondary: '#2a323c',
                        accent: '#ff5722',
                        text: '#a6adbb',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            },
            darkMode: 'class',
        }
    </script>

    <!-- FontAwesome CDN for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" xintegrity="sha512-iecdLmaskl7CVKsyXo58+g6vBf8G/2tX0s+8/b1tT7R8r+H8g2t5I5Fp5F4P6I6QpG4+hG6wA6P6g7H7D5S6g=" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Custom Styles -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        .dark body {
            background-color: #1d232a;
            color: #a6adbb;
        }

        .light body {
            background-color: #f0f2f5;
            color: #333;
        }

        .movie-card {
            min-width: 200px;
            max-width: 200px;
        }

        .movie-card img {
            transition: transform 0.3s ease;
        }

        .movie-card:hover img {
            transform: scale(1.05);
        }

        .hide {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-primary text-gray-900 dark:text-text">
    <header class="bg-white dark:bg-secondary shadow-md sticky top-0 z-50">
        <div class="container mx-auto p-4 flex flex-col sm:flex-row justify-between items-center space-y-4 sm:space-y-0">
            <a href="#" id="home-nav" class="text-2xl font-bold text-accent">Streamflix</a>
            <nav class="flex space-x-4">
                <a href="#" id="movies-nav" class="text-lg hover:text-accent transition-colors">Film</a>
                <a href="#" id="tv-shows-nav" class="text-lg hover:text-accent transition-colors">Acara TV</a>
            </nav>
            <div class="flex items-center space-x-4">
                <form id="search-form" class="relative">
                    <input type="text" id="search-input" placeholder="Cari film atau acara..." class="w-full sm:w-64 py-2 pl-10 pr-4 rounded-full bg-gray-200 dark:bg-primary focus:outline-none focus:ring-2 focus:ring-accent transition-all">
                    <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-500"></i>
                </form>
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-primary transition-colors">
                    <i id="theme-icon" class="fas fa-moon text-xl text-gray-600 dark:text-gray-400"></i>
                </button>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 mt-8 min-h-screen">
        <!-- Home Page -->
        <div id="home-page" class="page-section">
            <h1 class="text-3xl font-bold mb-6">Selamat Datang di Streamflix</h1>
            <div id="loading-spinner" class="text-center my-10">
                <i class="fas fa-spinner fa-spin text-4xl text-accent"></i>
                <p class="mt-2 text-lg">Memuat konten...</p>
            </div>
            
            <section id="popular-movies-section" class="mb-10 hide">
                <h2 class="text-2xl font-bold mb-4">Film Populer</h2>
                <div id="popular-movies-list" class="flex overflow-x-auto gap-4 py-2 scroll-smooth"></div>
            </section>
            
            <section id="now-playing-movies-section" class="mb-10 hide">
                <h2 class="text-2xl font-bold mb-4">Sedang Tayang</h2>
                <div id="now-playing-movies-list" class="flex overflow-x-auto gap-4 py-2 scroll-smooth"></div>
            </section>

            <section id="upcoming-movies-section" class="mb-10 hide">
                <h2 class="text-2xl font-bold mb-4">Akan Datang</h2>
                <div id="upcoming-movies-list" class="flex overflow-x-auto gap-4 py-2 scroll-smooth"></div>
            </section>

            <section id="top-rated-movies-section" class="mb-10 hide">
                <h2 class="text-2xl font-bold mb-4">Peringkat Teratas</h2>
                <div id="top-rated-movies-list" class="flex overflow-x-auto gap-4 py-2 scroll-smooth"></div>
            </section>
        </div>

        <!-- Movies Page -->
        <div id="movies-page" class="page-section hide">
            <h1 class="text-3xl font-bold mb-6">Semua Film</h1>
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6" id="all-movies-container"></div>
        </div>
        
        <!-- TV Shows Page -->
        <div id="tv-shows-page" class="page-section hide">
            <h1 class="text-3xl font-bold mb-6">Semua Acara TV</h1>
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6" id="all-tv-shows-container"></div>
        </div>

        <!-- Detail Page -->
        <div id="detail-page" class="page-section hide">
            <!-- Content will be dynamically injected here -->
        </div>

        <!-- Search Results Page -->
        <div id="search-results-page" class="page-section hide">
            <h1 class="text-3xl font-bold mb-6">Hasil Pencarian untuk: <span id="search-query-text"></span></h1>
            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6" id="search-results-container"></div>
        </div>

    </main>

    <footer class="bg-secondary text-text py-6 mt-10">
        <div class="container mx-auto text-center">
            <p>&copy; 2024 Streamflix. Hak Cipta Dilindungi.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // =================================================================
            // Configuration and API Proxy URL
            // =================================================================
            // Gunakan URL proxy yang disediakan pengguna
            const TMDB_API_PROXY = 'https://tmdb-api-proxy-1.musadekakhmad.workers.dev';
            const TMDB_IMAGE_BASE_URL = 'https://image.tmdb.org/t/p/w500';

            // =================================================================
            // Theme Toggle Logic
            // =================================================================
            const themeToggle = document.getElementById('theme-toggle');
            const themeIcon = document.getElementById('theme-icon');

            const updateThemeIcons = (isDark) => {
                if (isDark) {
                    themeIcon.classList.remove('fa-moon');
                    themeIcon.classList.add('fa-sun');
                } else {
                    themeIcon.classList.remove('fa-sun');
                    themeIcon.classList.add('fa-moon');
                }
            };

            const toggleTheme = () => {
                const isDark = document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
                updateThemeIcons(isDark);
            };

            // Set initial theme
            const storedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const currentTheme = storedTheme || (prefersDark ? 'dark' : 'light');
            if (currentTheme === 'dark') {
                document.documentElement.classList.add('dark');
            }
            updateThemeIcons(currentTheme === 'dark');

            themeToggle.addEventListener('click', toggleTheme);

            // =================================================================
            // UI State Management and Page Navigation
            // =================================================================
            const pageSections = document.querySelectorAll('.page-section');
            const showPage = (pageId) => {
                pageSections.forEach(section => {
                    section.classList.add('hide');
                });
                document.getElementById(pageId).classList.remove('hide');
            };

            const showHomePage = async () => {
                showPage('home-page');
                document.getElementById('loading-spinner').classList.remove('hide');
                
                // Clear previous content
                document.getElementById('popular-movies-list').innerHTML = '';
                document.getElementById('now-playing-movies-list').innerHTML = '';
                document.getElementById('upcoming-movies-list').innerHTML = '';
                document.getElementById('top-rated-movies-list').innerHTML = '';

                // Define categories to fetch
                const categories = [
                    { id: 'popular-movies', endpoint: 'movie/popular', listId: 'popular-movies-list', sectionId: 'popular-movies-section' },
                    { id: 'now-playing-movies', endpoint: 'movie/now_playing', listId: 'now-playing-movies-list', sectionId: 'now-playing-movies-section' },
                    { id: 'top-rated-movies', endpoint: 'movie/top_rated', listId: 'top-rated-movies-list', sectionId: 'top-rated-movies-section' },
                    { id: 'upcoming-movies', endpoint: 'movie/upcoming', listId: 'upcoming-movies-list', sectionId: 'upcoming-movies-section' },
                ];
                
                // Fetch data for all categories concurrently
                const fetchPromises = categories.map(cat => fetchContentListForCategory(cat.endpoint));
                
                try {
                    const results = await Promise.all(fetchPromises);
                    results.forEach((movies, index) => {
                        if (movies) {
                            const category = categories[index];
                            renderContentList(movies, document.getElementById(category.listId), 'movie');
                            document.getElementById(category.sectionId).classList.remove('hide');
                        }
                    });
                } catch (error) {
                    console.error('Error in showHomePage:', error);
                    // Handle global error display, e.g., show a message to the user
                } finally {
                    document.getElementById('loading-spinner').classList.add('hide');
                }
            };
            
            const showMoviesPage = async () => {
                showPage('movies-page');
                const container = document.getElementById('all-movies-container');
                container.innerHTML = `<div class="col-span-full text-center my-10"><i class="fas fa-spinner fa-spin text-4xl text-accent"></i></div>`;
                
                const movies = await fetchContentListForCategory('movie/popular'); // Using popular as a default
                if (movies) {
                    renderContentList(movies, container, 'movie');
                } else {
                    container.innerHTML = `<p class="col-span-full text-center text-red-500">Gagal memuat film.</p>`;
                }
            };

            const showTvShowsPage = async () => {
                showPage('tv-shows-page');
                const container = document.getElementById('all-tv-shows-container');
                container.innerHTML = `<div class="col-span-full text-center my-10"><i class="fas fa-spinner fa-spin text-4xl text-accent"></i></div>`;

                const tvShows = await fetchContentListForCategory('tv/popular'); // Using popular as a default
                if (tvShows) {
                    renderContentList(tvShows, container, 'tv');
                } else {
                    container.innerHTML = `<p class="col-span-full text-center text-red-500">Gagal memuat acara TV.</p>`;
                }
            };

            const showDetailPage = async (id, type) => {
                showPage('detail-page');
                const detailContainer = document.getElementById('detail-page');
                detailContainer.innerHTML = `<div class="text-center my-10"><i class="fas fa-spinner fa-spin text-4xl text-accent"></i></div>`;
                
                const content = await fetchContentDetails(id, type);
                if (content) {
                    renderContentDetail(content, type, detailContainer);
                } else {
                    detailContainer.innerHTML = `<p class="text-center text-red-500">Gagal memuat detail konten.</p>`;
                }
            };

            const showSearchResultsPage = async (query) => {
                showPage('search-results-page');
                document.getElementById('search-query-text').textContent = query;
                const container = document.getElementById('search-results-container');
                container.innerHTML = `<div class="col-span-full text-center my-10"><i class="fas fa-spinner fa-spin text-4xl text-accent"></i></div>`;

                const results = await performSearch(query);
                if (results && results.length > 0) {
                    renderContentList(results, container, 'multi');
                } else {
                    container.innerHTML = `<p class="col-span-full text-center text-lg">Tidak ada hasil ditemukan untuk "${query}".</p>`;
                }
            };

            // =================================================================
            // Data Fetching Functions (Using Proxy URL)
            // =================================================================
            const fetchFromTMDB = async (endpoint) => {
                const url = `${TMDB_API_PROXY}/${endpoint}?language=id-ID`;
                
                try {
                    const response = await fetch(url);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return await response.json();
                } catch (error) {
                    console.error(`Gagal mengambil data dari ${url}:`, error);
                    return null;
                }
            };

            const fetchContentListForCategory = async (endpoint) => {
                const data = await fetchFromTMDB(endpoint);
                return data ? data.results : null;
            };

            const fetchContentDetails = async (id, type) => {
                const data = await fetchFromTMDB(`${type}/${id}`);
                return data;
            };

            const performSearch = async (query) => {
                const data = await fetchFromTMDB(`search/multi?query=${encodeURIComponent(query)}`);
                if (data) {
                    return data.results.filter(item => item.media_type !== 'person');
                }
                return null;
            };

            // =================================================================
            // Rendering Functions
            // =================================================================
            const createCard = (item, type) => {
                const posterPath = item.poster_path ? `${TMDB_IMAGE_BASE_URL}${item.poster_path}` : 'https://placehold.co/500x750?text=Poster+Tidak+Tersedia';
                const title = type === 'movie' || item.media_type === 'movie' ? item.title : item.name;
                const releaseDate = type === 'movie' || item.media_type === 'movie' ? item.release_date : item.first_air_date;
                const releaseYear = releaseDate ? new Date(releaseDate).getFullYear() : 'N/A';
                
                const card = document.createElement('div');
                card.className = 'movie-card relative rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-all cursor-pointer bg-white dark:bg-secondary';
                card.innerHTML = `
                    <img src="${posterPath}" alt="${title}" class="w-full h-auto rounded-lg">
                    <div class="p-2">
                        <h3 class="text-sm font-semibold truncate mt-1 text-gray-900 dark:text-gray-200">${title}</h3>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">${releaseYear}</p>
                    </div>
                `;
                card.addEventListener('click', () => showDetailPage(item.id, type === 'multi' ? item.media_type : type));
                return card;
            };

            const renderContentList = (list, container, type) => {
                container.innerHTML = ''; // Clear container
                if (list && list.length > 0) {
                    list.forEach(item => {
                        container.appendChild(createCard(item, type));
                    });
                } else {
                    container.innerHTML = `<p class="col-span-full text-center text-lg">Tidak ada konten untuk ditampilkan.</p>`;
                }
            };

            const renderContentDetail = (content, type, container) => {
                const posterPath = content.poster_path ? `${TMDB_IMAGE_BASE_URL}${content.poster_path}` : 'https://placehold.co/500x750?text=Poster+Tidak+Tersedia';
                const title = type === 'movie' ? content.title : content.name;
                const overview = content.overview || 'Sinopsis tidak tersedia.';
                const rating = content.vote_average ? content.vote_average.toFixed(1) : 'N/A';
                const genres = content.genres ? content.genres.map(g => g.name).join(', ') : 'N/A';
                const releaseDate = type === 'movie' ? content.release_date : content.first_air_date;
                const runtime = type === 'movie' ? `${content.runtime} menit` : 'N/A';
                
                container.innerHTML = `
                    <div class="flex flex-col md:flex-row items-start md:space-x-8 bg-white dark:bg-secondary rounded-lg shadow-lg p-6">
                        <div class="flex-shrink-0 mb-6 md:mb-0">
                            <img src="${posterPath}" alt="${title}" class="w-full md:w-64 rounded-lg shadow-md">
                        </div>
                        <div class="flex-grow">
                            <h1 class="text-4xl font-bold text-gray-900 dark:text-white mb-2">${title}</h1>
                            <p class="text-lg text-gray-600 dark:text-gray-300 mb-4">${type === 'movie' ? 'Film' : 'Acara TV'}</p>
                            <div class="flex items-center space-x-4 text-gray-500 dark:text-gray-400 mb-4">
                                <span class="flex items-center"><i class="fas fa-star text-yellow-400 mr-1"></i> ${rating}</span>
                                <span>|</span>
                                <span>${genres}</span>
                                <span>|</span>
                                <span>${releaseDate}</span>
                                ${type === 'movie' ? `<span>|</span><span>${runtime}</span>` : ''}
                            </div>
                            <p class="text-gray-700 dark:text-gray-200 leading-relaxed mb-6">${overview}</p>
                            <button onclick="showHomePage()" class="px-6 py-2 bg-accent text-white font-semibold rounded-full hover:bg-orange-600 transition-colors">
                                Kembali ke Beranda
                            </button>
                        </div>
                    </div>
                `;
            };

            // =================================================================
            // Event Listeners
            // =================================================================
            document.getElementById('home-nav').addEventListener('click', (e) => { e.preventDefault(); showHomePage(); });
            document.getElementById('movies-nav').addEventListener('click', (e) => { e.preventDefault(); showMoviesPage(); });
            document.getElementById('tv-shows-nav').addEventListener('click', (e) => { e.preventDefault(); showTvShowsPage(); });
            document.getElementById('search-form').addEventListener('submit', (event) => {
                event.preventDefault();
                const query = document.getElementById('search-input').value.trim();
                if (query) {
                    showSearchResultsPage(query);
                }
            });

            // Initial load
            showHomePage();
        });
    </script>
</body>
</html>
